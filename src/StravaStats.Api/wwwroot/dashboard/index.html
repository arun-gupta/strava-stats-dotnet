<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Strava Stats ‚Äî Dashboard</title>
    <link rel="stylesheet" href="https://unpkg.com/@picocss/pico@2.0.6/css/pico.min.css">
    <link rel="stylesheet" href="/dashboard/css/site.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
    <style>
      header.container { margin-top: 1rem; }
      table { font-size: .95rem; }
    </style>
  </head>
  <body>
    <header class="container">
      <nav>
        <ul>
          <li><span class="brand">Strava Stats</span></li>
        </ul>
        <ul id="authArea">
          <li class="muted">Checking session‚Ä¶</li>
        </ul>
      </nav>
    </header>

    <main class="container" role="main">
      <!-- Date Range Picker -->
      <section class="card" id="dateRangeCard">
        <div class="date-range-picker">
          <button class="date-range-btn" data-range="last7">Last 7 Days</button>
          <button class="date-range-btn active" data-range="last30">Last 30 Days</button>
          <button class="date-range-btn" data-range="last90">Last 90 Days</button>
          <button class="date-range-btn" data-range="last6months">Last 6 Months</button>
          <button class="date-range-btn" data-range="ytd">Year to Date</button>
          <button class="date-range-btn" data-range="all">All Time</button>
          <button class="date-range-btn" data-range="custom">Custom Range</button>

          <div id="customDateInputs" class="custom-date-inputs hidden">
            <label for="customStart">Start:</label>
            <input type="date" id="customStart" />
            <label for="customEnd">End:</label>
            <input type="date" id="customEnd" />
          </div>
        </div>
      </section>

      <!-- Tab Navigation -->
      <nav class="tab-nav">
        <button class="tab-btn active" data-tab="overview">üìä Overview</button>
        <button class="tab-btn" data-tab="activity-count">üìà Activity Count</button>
        <button class="tab-btn" data-tab="time-dist">‚è±Ô∏è Time Distribution</button>
        <button class="tab-btn" data-tab="heatmap">üî• Heatmap</button>
        <button class="tab-btn" data-tab="running-stats">üèÉ Running Stats</button>
      </nav>

      <!-- Tab Panels -->
      <div class="tab-content">
        <!-- Overview Tab -->
        <div id="tab-overview" class="tab-panel active">
          <div class="dashboard-grid">
      <section id="totalsCard" class="card">
        <h4 id="totalsTitle">Last 30 Days</h4>
        <div id="totalsLoading">Loading totals‚Ä¶</div>
        <div id="totals" class="hidden">
          <div class="grid">
            <article>
              <header>Total Activities</header>
              <strong id="totCount">‚Äî</strong>
            </article>
            <article>
              <header>Total Distance</header>
              <strong id="totDistance">‚Äî</strong>
            </article>
            <article>
              <header>Total Moving Time</header>
              <strong id="totTime">‚Äî</strong>
            </article>
            <article>
              <header>Avg per Activity</header>
              <strong id="avgPer">‚Äî</strong>
            </article>
          </div>
        </div>
        <div id="totalsEmpty" class="hidden">No activities in the last 30 days.</div>
      </section>

      <section class="card">
        <h4>Recent Activities</h4>
        <div id="recentLoading">Loading recent activities‚Ä¶</div>
        <div class="overflow-auto card-scroll">
          <table id="recentTable" class="hidden">
            <thead>
              <tr>
                <th>Date</th>
                <th>Name</th>
                <th>Type</th>
                <th class="right">Distance</th>
                <th class="right">Moving Time</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <div id="recentEmpty" class="hidden">No recent activities.</div>
      </section>
          </div>
        </div>
        <!-- End Overview Tab -->

        <!-- Activity Count Tab -->
        <div id="tab-activity-count" class="tab-panel">
          <section class="card">
            <h4>Number of Activities by Type</h4>
            <div class="chart-container">
              <canvas id="activityCountChart"></canvas>
            </div>
          </section>
        </div>
        <!-- End Activity Count Tab -->

        <!-- Time Distribution Tab -->
        <div id="tab-time-dist" class="tab-panel">
          <section class="card">
            <h4>Time Distribution by Type</h4>
            <div class="chart-container">
              <canvas id="timeDistChart"></canvas>
            </div>
          </section>
        </div>
        <!-- End Time Distribution Tab -->

        <!-- Heatmap Tab -->
        <div id="tab-heatmap" class="tab-panel">
          <section class="card">
            <div class="flex-between">
              <h4 style="margin:0">Activity Calendar</h4>
              <div class="segmented">
                <button id="hmAllBtn" class="seg-btn active" data-mode="all">All Activities</button>
                <button id="hmRunBtn" class="seg-btn" data-mode="running">Running Only</button>
              </div>
            </div>

            <div id="heatmapLegend" class="heatmap-legend" aria-hidden="true">
              <span>Less</span>
              <span class="legend-box level-0"></span>
              <span class="legend-box level-1"></span>
              <span class="legend-box level-2"></span>
              <span class="legend-box level-3"></span>
              <span class="legend-box level-4"></span>
              <span>More</span>
            </div>

            <div id="heatmap" class="heatmap" role="img" aria-label="Activity calendar heatmap"></div>
          </section>

          <section class="card">
            <h4>Streaks</h4>
            <div class="grid">
              <article>
                <header>Current Streak</header>
                <strong id="currentStreak">0 days</strong>
              </article>
              <article>
                <header>Longest Streak</header>
                <strong id="longestStreak">0 days</strong>
              </article>
            </div>
          </section>
        </div>
        <!-- End Heatmap Tab -->

        <!-- Running Stats Tab -->
        <div id="tab-running-stats" class="tab-panel">
          <section class="card">
            <h4>Distance Distribution</h4>
            <div class="chart-container">
              <canvas id="distanceHistogramChart"></canvas>
            </div>
          </section>

          <section class="card">
            <h4>Running Summary</h4>
            <div id="runningStatsLoading">Loading running stats‚Ä¶</div>
            <div id="runningStats" class="hidden">
              <div class="grid">
                <article>
                  <header>Total Runs</header>
                  <strong id="totalRuns">‚Äî</strong>
                </article>
                <article>
                  <header>10K+ Runs</header>
                  <strong id="runs10kPlus">‚Äî</strong>
                </article>
                <article>
                  <header>Total Distance</header>
                  <strong id="totalRunDistance">‚Äî</strong>
                </article>
                <article>
                  <header>Avg Pace</header>
                  <strong id="avgPace">‚Äî</strong>
                </article>
                <article>
                  <header>Fastest 10K</header>
                  <strong id="fastest10k">‚Äî</strong>
                </article>
                <article>
                  <header>Longest Run</header>
                  <strong id="longestRun">‚Äî</strong>
                </article>
              </div>
            </div>
            <div id="runningStatsEmpty" class="hidden">No running activities in the selected date range.</div>
          </section>
        </div>
        <!-- End Running Stats Tab -->
      </div>
      <!-- End Tab Content -->

      <footer class="muted" style="margin-top:2rem">Built quickly with vanilla JS. Data from your Strava account.</footer>
    </main>

    <script type="module" src="/dashboard/app.js"></script>
  </body>
  </html>
