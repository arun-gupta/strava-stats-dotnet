<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Strava Activity Analyzer ‚Äî Dashboard</title>
    <link rel="stylesheet" href="https://unpkg.com/@picocss/pico@2.0.6/css/pico.min.css">
    <link rel="stylesheet" href="/dashboard/css/site.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
    <style>
      header.container { margin-top: 1rem; }
      table { font-size: .95rem; }
    </style>
  </head>
  <body>
    <header class="container">
      <nav>
        <ul>
          <li><a href="/dashboard/" class="brand" style="text-decoration: none;">Strava Activity Analyzer</a></li>
        </ul>
        <ul id="authArea">
          <li class="muted">Checking session‚Ä¶</li>
        </ul>
      </nav>
    </header>

    <main class="container" role="main">
      <!-- Date Range Picker -->
      <section class="card" id="dateRangeCard">
        <div class="date-range-picker">
          <button class="date-range-btn active" data-range="last7">Last 7 Days</button>
          <button class="date-range-btn" data-range="last30">Last 30 Days</button>
          <button class="date-range-btn" data-range="last90">Last 90 Days</button>
          <button class="date-range-btn" data-range="last6months">Last 6 Months</button>
          <button class="date-range-btn" data-range="ytd">Year to Date</button>
          <button class="date-range-btn" data-range="all">All Time</button>
          <button class="date-range-btn" data-range="custom">Custom Range</button>

          <div id="customDateInputs" class="custom-date-inputs hidden">
            <label for="customStart">Start:</label>
            <input type="date" id="customStart" />
            <label for="customEnd">End:</label>
            <input type="date" id="customEnd" />
          </div>
        </div>
      </section>

      <!-- Dashboard Summary -->
      <section class="card" id="dashboardSummary">
        <div id="summaryLoading">Loading activities‚Ä¶</div>
        <div id="summaryEmpty" class="hidden">No activities in the selected date range.</div>
        <div id="summary" class="hidden">
          <div class="dashboard-stats">
            <div class="stat-card">
              <div class="stat-label">Date Range</div>
              <div class="stat-value" id="summaryDateRange">Last 7 Days</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">Total Activities</div>
              <div class="stat-value" id="summaryTotalActivities">‚Äî</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">Total Moving Time</div>
              <div class="stat-value" id="summaryTotalTime">‚Äî</div>
            </div>
          </div>
        </div>
      </section>

      <!-- Tab Navigation -->
      <nav class="tab-nav">
        <button class="tab-btn active" data-tab="overview">üìä Overview</button>
        <button class="tab-btn" data-tab="time-dist">‚è±Ô∏è Duration</button>
        <button class="tab-btn" data-tab="heatmap">üî• Heatmap</button>
        <button class="tab-btn" data-tab="trends">üìà Trends</button>
        <button class="tab-btn" data-tab="running-stats">üèÉ Running Stats</button>
      </nav>

      <!-- Tab Panels -->
      <div class="tab-content">
        <!-- Overview Tab -->
        <div id="tab-overview" class="tab-panel active">
          <section class="card">
            <h4>Activity Count Distribution</h4>
            <div id="activityCountEmpty" class="hidden">No activities in the selected date range.</div>
            <div class="chart-container">
              <div id="activityCountLoading" class="loading">
                <div class="spinner"></div>
                <div class="loading-text">Loading chart...</div>
              </div>
              <canvas id="activityCountChart" style="display: none;"></canvas>
            </div>
          </section>
        </div>
        <!-- End Overview Tab -->

        <!-- Duration Tab -->
        <div id="tab-time-dist" class="tab-panel">
          <section class="card">
            <h4>Duration by Type</h4>
            <div id="timeDistEmpty" class="hidden">No activities in the selected date range.</div>
            <div class="chart-container">
              <div id="timeDistLoading" class="loading">
                <div class="spinner"></div>
                <div class="loading-text">Loading chart...</div>
              </div>
              <canvas id="timeDistChart" style="display: none;"></canvas>
            </div>
          </section>
        </div>
        <!-- End Duration Tab -->

        <!-- Heatmap Tab -->
        <div id="tab-heatmap" class="tab-panel">
          <section class="card">
            <div class="flex-between">
              <h4 style="margin:0">Activity Calendar</h4>
              <div class="segmented">
                <button id="hmAllBtn" class="seg-btn active" data-mode="all">All Activities</button>
                <button id="hmRunBtn" class="seg-btn" data-mode="running">Running Only</button>
              </div>
            </div>

            <div id="heatmapLegend" class="heatmap-legend" aria-hidden="true">
              <span class="legend-item">
                <span class="legend-box level-0"></span>
                <span class="legend-label" id="legendLabel0">No Activity</span>
              </span>
              <span class="legend-item">
                <span class="legend-box level-1"></span>
                <span class="legend-label" id="legendLabel1">&lt; 1h</span>
              </span>
              <span class="legend-item">
                <span class="legend-box level-2"></span>
                <span class="legend-label" id="legendLabel2">1-2h</span>
              </span>
              <span class="legend-item">
                <span class="legend-box level-3"></span>
                <span class="legend-label" id="legendLabel3">2h+</span>
              </span>
            </div>

            <div id="heatmap" class="heatmap" role="img" aria-label="Activity calendar heatmap"></div>
          </section>

          <section class="card">
            <h4>Workout Statistics</h4>
            <div class="workout-stats-grid">
              <article class="workout-stat">
                <header>Workout Days</header>
                <strong id="workoutDays">‚Äî</strong>
              </article>
              <article class="workout-stat">
                <header>Missed Days</header>
                <strong id="missedDays">‚Äî</strong>
              </article>
              <article class="workout-stat">
                <header>Current Streak</header>
                <strong id="currentStreak">‚Äî</strong>
              </article>
              <article class="workout-stat">
                <header>Days Since Last</header>
                <strong id="daysSinceLast">‚Äî</strong>
              </article>
              <article class="workout-stat">
                <header>Longest Gap</header>
                <strong id="longestGap">‚Äî</strong>
              </article>
              <article class="workout-stat">
                <header>Total Gap Days</header>
                <strong id="totalGapDays">‚Äî</strong>
              </article>
            </div>
            <button id="showGapDetailsBtn" class="secondary outline" style="margin-top: 1rem;">Show Gap Details</button>
            <div id="gapDetails" class="hidden" style="margin-top: 1rem;">
              <h5>Gap Periods</h5>
              <div id="gapList"></div>
            </div>
          </section>
        </div>
        <!-- End Heatmap Tab -->

        <!-- Trends Tab -->
        <div id="tab-trends" class="tab-panel">
          <section class="card">
            <div class="flex-between">
              <h4 style="margin:0">Running Trends</h4>
              <div class="segmented">
                <button class="seg-btn" data-granularity="day">Daily</button>
                <button class="seg-btn active" data-granularity="week">Weekly</button>
                <button class="seg-btn" data-granularity="month">Monthly</button>
                <button class="seg-btn" data-granularity="year">Yearly</button>
              </div>
            </div>
          </section>

          <section class="card">
            <h4>Distance Over Time</h4>
            <div id="distanceTrendEmpty" class="hidden">No running activities in the selected date range.</div>
            <div class="chart-container">
              <div id="distanceTrendLoading" class="loading">
                <div class="spinner"></div>
                <div class="loading-text">Loading chart...</div>
              </div>
              <canvas id="distanceTrendChart" style="display: none;"></canvas>
            </div>
          </section>

          <section class="card">
            <h4>Pace Over Time</h4>
            <div id="paceTrendEmpty" class="hidden">No running activities in the selected date range.</div>
            <div class="chart-container">
              <div id="paceTrendLoading" class="loading">
                <div class="spinner"></div>
                <div class="loading-text">Loading chart...</div>
              </div>
              <canvas id="paceTrendChart" style="display: none;"></canvas>
            </div>
          </section>
        </div>
        <!-- End Trends Tab -->

        <!-- Running Stats Tab -->
        <div id="tab-running-stats" class="tab-panel">
          <section class="card">
            <h4>Running Summary</h4>
            <div id="runningStatsLoading">Loading running stats‚Ä¶</div>
            <div id="runningStats" class="hidden">
              <div class="grid">
                <article>
                  <header>Total Runs</header>
                  <strong id="totalRuns">‚Äî</strong>
                </article>
                <article>
                  <header>10K+ Runs</header>
                  <strong id="runs10kPlus">‚Äî</strong>
                </article>
                <article>
                  <header>Total Distance</header>
                  <strong id="totalRunDistance">‚Äî</strong>
                </article>
                <article>
                  <header>Avg Pace</header>
                  <strong id="avgPace">‚Äî</strong>
                </article>
                <article>
                  <header>Fastest 10K</header>
                  <strong id="fastest10k">‚Äî</strong>
                </article>
                <article>
                  <header>Longest Run</header>
                  <strong id="longestRun">‚Äî</strong>
                </article>
              </div>
            </div>
            <div id="runningStatsEmpty" class="hidden">No running activities in the selected date range.</div>
          </section>

          <section class="card">
            <h4>Distance Distribution</h4>
            <div id="distanceHistogramEmpty" class="hidden">No running activities in the selected date range.</div>
            <div class="chart-container">
              <div id="distanceHistogramLoading" class="loading">
                <div class="spinner"></div>
                <div class="loading-text">Loading chart...</div>
              </div>
              <canvas id="distanceHistogramChart" style="display: none;"></canvas>
            </div>
          </section>
        </div>
        <!-- End Running Stats Tab -->
      </div>
      <!-- End Tab Content -->

      <footer class="muted" style="margin-top:2rem">Built quickly with vanilla JS. Data from your Strava account.</footer>
    </main>

    <!-- Toast Container -->
    <div id="toastContainer" aria-live="polite" aria-atomic="true"></div>

    <script type="module" src="/dashboard/app.js"></script>
  </body>
  </html>
