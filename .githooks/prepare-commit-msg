#!/usr/bin/env sh
# Git prepare-commit-msg hook to ensure a co-author trailer is present.
# Appends "Co-authored-by: Junie <junie@jetbrains.com>" if missing.
# Skips merge commits and commits with any existing Co-Authored-By trailer.

MSG_FILE="$1"
SOURCE="$2"

# Do not modify merge commits (Git provides a default merge message)
if [ "$SOURCE" = "merge" ]; then
  exit 0
fi

# If the message already contains any Co-Authored-By trailer, do nothing
if grep -qi "^Co-Authored-By:" "$MSG_FILE"; then
  exit 0
fi

COAUTHOR_LINE="Co-authored-by: Junie <junie@jetbrains.com>"

# Ensure there is a blank line before trailers per git convention
printf "\n%s\n" "$COAUTHOR_LINE" >> "$MSG_FILE"

exit 0
